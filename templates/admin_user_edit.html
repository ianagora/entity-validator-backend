{% extends "base.html" %}
{% block title %}{{ 'New User' if not user else 'Edit User' }} â€“ Scrutinise{% endblock %}
{% block page_title %}{{ 'New User' if not user else 'Edit User' }}{% endblock %}

{% block content %}
<form method="post" action="{{ '/admin/users/new' if not user else '/admin/users/%d/edit' % user.id }}"
      style="display:grid; gap:16px; max-width:760px;">

  <div style="display:grid; gap:10px; grid-template-columns:1fr 1fr;">
    <div>
      <label style="font-weight:700;">Email</label>
      <input type="email" name="email" required value="{{ user.email if user else '' }}"
             style="width:100%;border:1px solid #e5e7eb;padding:10px;border-radius:10px;background:#fff;">
    </div>
    <div>
      <label style="font-weight:700;">Full name</label>
      <input type="text" name="full_name" value="{{ user.full_name if user else '' }}"
             style="width:100%;border:1px solid #e5e7eb;padding:10px;border-radius:10px;background:#fff;">
    </div>
  </div>

  {% if not user %}
    <div>
      <label style="font-weight:700;">Password</label>
      <input type="password" name="password" required
             style="width:100%;border:1px solid #e5e7eb;padding:10px;border-radius:10px;background:#fff;">
      <div style="color:#64748b;font-size:12px;margin-top:6px;">Set an initial password for the user.</div>
    </div>
  {% else %}
    <div>
      <label style="font-weight:700;">New password (optional)</label>
      <input type="password" name="new_password"
             style="width:100%;border:1px solid #e5e7eb;padding:10px;border-radius:10px;background:#fff;">
      <div style="color:#64748b;font-size:12px;margin-top:6px;">Leave blank to keep the current password.</div>
    </div>
  {% endif %}

  <div>
    <label style="font-weight:700; display:block; margin-bottom:6px;">Roles</label>
    <div style="display:flex; flex-wrap:wrap; gap:10px;">
      {% set selected = user_role_ids if user else [] %}
      {% for r in all_roles %}
        <label style="display:flex; align-items:center; gap:8px; border:1px solid #e5e7eb; padding:8px 10px; border-radius:10px; background:#fff;">
          <input type="checkbox" name="roles" value="{{ r.id }}" {% if r.id in selected %}checked{% endif %}>
          {{ r.name }}
        </label>
      {% endfor %}
    </div>
  </div>

  <div>
    <label style="font-weight:700;">Status</label>
    <select name="is_active"
            style="width:220px;border:1px solid #e5e7eb;padding:10px;border-radius:10px;background:#fff;">
      <option value="1" {% if not user or user.is_active %}selected{% endif %}>Active</option>
      <option value="0" {% if user and not user.is_active %}selected{% endif %}>Disabled</option>
    </select>
  </div>

  <div class="toolbar" style="margin-top:8px;">
    <button class="btn primary" type="submit">
      <i class="fa-solid fa-floppy-disk"></i> Save
    </button>
    <a class="btn" href="/admin/users"><i class="fa-solid fa-arrow-left"></i> Back</a>
  </div>
</form>
{% endblock %}